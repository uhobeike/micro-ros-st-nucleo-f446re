![banner](https://i.gyazo.com/7fa1054f9993bbeda61176813ad7e019.png)
![micro-ROS-F446RE](https://user-images.githubusercontent.com/40545422/166133749-ff9056ff-8617-4045-911f-2c666e2cf0cd.gif)

# Intoroduction
This package is designed to quickly and easily run micro-ROS on a Nucleo-F446RE board!

Sample code is provided as well as environment construction. Once the environment has been built, you can immediately get it running and try it out.

[The sample code is ready to run publish and subscribe on `std_msgs/string` and `sensor_msgs/imu`!](https://github.com/uhobeike/inverted_pendulum_robot/blob/7b8653d8ea591b9723265c478f49e386b43d39ba/Core/Src/main.c#L399-L423)



# Required Environment
| Software           | Required Version          | 
| ------------------ | ------------------------- | 
| STM32CubeIDE       | 1.9.0                     | 
| Linux distribution | Ubuntu 18.04 LTS or later | 
| Docker             | 20.10.14 or later         | 

| Hardware      | URL                                                       | 
| ------------- | --------------------------------------------------------- | 
| NUCLEO-F446RE | https://www.st.com/ja/evaluation-tools/nucleo-f446re.html | 

# Quick start

<details>
<summary>1. Install required software</summary>
  <details open>
  <summary>Docker</summary>

* Install docker
```
sudo apt-get update
sudo apt-get install -y curl
curl -fsSL https://get.docker.com/ | sh
docker --version
```

* Setup docker
```
sudo groupadd docker
sudo gpasswd -a $USER docker
sudo systemctl restart docker
sudo reboot
```

  </details>
  
  <details open>
  <summary>STM32CubeIDE</summary>

* Install stm32cubeide

Please download from [this site](https://www.st.com/ja/development-tools/stm32cubeide.html).
![stm32cubeide-download](https://i.gyazo.com/9da797706f687ae145b0ff30bf3110eb.png)

  </details>
</details>

<details>
<summary>2. How to use this repository</summary>
  <details open>
  <summary>git clone</summary>

* Clone  [uhobeike/inverted_pendulum_robot](https://github.com/uhobeike/inverted_pendulum_robot/tree/update/readme)

```
git clone --recursive https://github.com/uhobeike/inverted_pendulum_robot.git
```

  </details>
  
  <details open>
  <summary>Import your project in STM32CubeIDE</summary>
  
* Launch of STM32CubeIDE
```
/opt/st/stm32cubeide_1.9.0/stm32cubeide
```

![launch-stm32cubeide](https://i.gyazo.com/eee876312d397f9a11bfdf930d57c511.png)

* Import project (inverted_pendulum_robot)

![import-project1](https://i.gyazo.com/a2b8fa88a38b3ef9828b5834cbf1713f.png)

![import-project2](https://i.gyazo.com/47b9bfd50f73cc47563dddd69b397d75.png)

![import-project3](https://i.gyazo.com/9bdf914e126ccc56fd022121aa7e014d.png)

* Import Complete

![import-complete](https://i.gyazo.com/1d62fc7b77bb3fbe1ff45a24b99e28e3.png)

  </details>
 
</details>

<details>
<summary>3. Build and flush</summary>
  <details open>
  <summary>Build</summary>

Perhaps you can use [this package](https://github.com/micro-ROS/micro_ros_setup/blob/galactic/scripts/build_firmware.sh) to build on the command line, but this time we will build on the STM32CubeIDE.

* Build project

![build-project1](https://i.gyazo.com/6a96492a0276bc2864d12ee56c17edbe.jpg)

![build-project2](https://i.gyazo.com/93f187adde42a3509be83d13ed05a2fa.jpg)

![build-project3](https://i.gyazo.com/43450195926ddfcaa585d3969ba020a1.jpg)

  </details>
  
  <details open>
  <summary>Flush</summary>

To flush the executable binary generated by Build to NUCLEO-F446RE, connect the PC to NUCLEO-F446RE via USB or other means.

* Flushsing executable binaries to NUCLEO-F446RE

![flush-1](https://i.gyazo.com/5c312c7ab3ab27fd6a90300f46c692b3.jpg)

![flush-2](https://i.gyazo.com/9590cb23d1ccd4d8ce51eb58e14b8306.jpg)

![flush-3](https://i.gyazo.com/f3af6963710f76df7875440cbfde3bf8.jpg)

  </details>
 
</details>

<details>
<summary>4. Execute (Welcome to the world of micro-ROS!)</summary>
  
  <details open>
  <summary>Execute</summary>
  
ROS2 communication between PC and microcontroller using Docker environment.

* Execute micro-ROS!

```
docker run -it --privileged --net=host --name micro-ros ubeike/micro-ros-agent:galactic

# Executed at each terminal.
ros2 run micro_ros_agent micro_ros_agent serial --dev /dev/ttyACM0

# If you successfully subscribe, the LED(LD2) on the F446RE will flash!

# std_msgs/string pub/sub
ros2 topic echo /f446re_string_publisher
ros2 topic pub --once /f446re_string_subscriber std_msgs/msg/String "{data: Hello! micro-ROS}"

# sensor_msgs/imu pub/sub
ros2 topic echo /f446re_imu_publisher
ros2 topic pub --once /imu/data_raw sensor_msgs/msg/Imu
```



* Important point

It is necessary to press the reset button on the NUCLEO-F446RE after the execution of `ros2 run micro_ros_agent micro_ros_agent serial --dev /dev/ttyACM0` for normal communication between the NUCLEO-F446RE and the PC.

![reset-button-push](https://i.gyazo.com/693ad69785cb172586739a42cfcc8bd0.jpg)

  </details>
 
</details>
<details>
<summary>5. Let's develop</summary>

[This is the part of the micro-ROS code](https://github.com/uhobeike/inverted_pendulum_robot/blob/7b8653d8ea591b9723265c478f49e386b43d39ba/Core/Src/main.c#L359-L458) that serves as the F446RE node. Update this one to do what you want!

</details>

# Reference

### [micro-ROS/micro_ros_setup](https://github.com/micro-ROS/micro_ros_setup)
### [micro-ROS/micro-ROS-demos](https://github.com/micro-ROS/micro-ROS-demos)
### [micro-ROS/micro_ros_stm32cubemx_utils](https://github.com/micro-ROS/micro_ros_stm32cubemx_utils)
